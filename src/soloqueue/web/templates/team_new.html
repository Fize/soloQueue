{% extends "base.html" %}

{% block title %}New Team | SoloQueue{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0 small">
            <li class="breadcrumb-item"><a href="/teams">Teams</a></li>
            <li class="breadcrumb-item active">New</li>
        </ol>
    </nav>
</div>

<div class="card shadow-sm border-0" x-data="teamCreator()">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold">Create New Team</h5>
        <div>
            <a href="/teams" class="btn btn-outline-secondary btn-sm me-2">Cancel</a>
            <button @click="create" class="btn btn-primary btn-sm" :disabled="saving">
                <span x-show="saving" class="spinner-border spinner-border-sm me-1" role="status"
                    aria-hidden="true"></span>
                <span x-text="saving ? 'Creating...' : 'Create Team'"></span>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div x-show="error" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span x-text="error"></span>
            <button type="button" class="btn-close" @click="error = ''"></button>
        </div>
        <form @submit.prevent="create">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label fw-bold">Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" x-model="team.name" required
                        pattern="[a-zA-Z0-9_-]+" placeholder="e.g. my-team">
                    <div class="form-text">Letters, numbers, hyphens, underscores only.</div>
                </div>

                <div class="col-12">
                    <label class="form-label fw-bold">Description <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" x-model="team.description" required
                        placeholder="Brief description of this team">
                </div>

                <div class="col-12">
                    <label class="form-label fw-bold">Content (Markdown)</label>
                    <textarea class="form-control font-monospace small" rows="12" x-model="team.shared_context"
                        style="font-size: 0.85rem;" placeholder="Team configuration content in Markdown format..."></textarea>
                    <div class="form-text">The Markdown body content of the team configuration file.</div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('teamCreator', () => ({
            team: {
                name: '',
                description: '',
                shared_context: ''
            },
            saving: false,
            error: '',

            async create() {
                this.error = '';
                if (!this.team.name.trim() || !this.team.description.trim()) {
                    this.error = 'Name and Description are required.';
                    return;
                }

                this.saving = true;
                try {
                    const res = await fetch('/api/teams', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.team)
                    });
                    const data = await res.json();

                    if (res.ok && data.status === 'success') {
                        window.location.href = `/teams/${data.name}`;
                    } else {
                        this.error = data.message || 'Unknown error';
                    }
                } catch (e) {
                    this.error = 'Network error: ' + e;
                } finally {
                    this.saving = false;
                }
            }
        }))
    })
</script>
{% endblock %}
